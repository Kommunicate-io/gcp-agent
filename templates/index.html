<!DOCTYPE html>
<html>
<head>
  <title>GCP Project Health Agent</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container py-4">
  <h1>ðŸš€ GCP Project Health Agent</h1>
  <form method="POST" class="my-3">
    <label><b>Select Project:</b></label>
    <select name="project_id" class="form-select w-50 d-inline">
      {% for pid in projects %}
        <option value="{{pid}}" {% if result and result.project==pid %}selected{% endif %}>{{pid}}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Run</button>
  </form>

  {% if result %}
    <h3>Project: {{ result.project }}</h3>
    <p><b>Average CPU:</b> {{ result.cpu_avg }} | <b>Average Memory:</b> {{ result.mem_avg }}</p>
    <p><b>Running VMs:</b> {{ result.vm_count }}</p>

    <h4>Per-Instance (last 10m)</h4>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Instance</th>
          <th>Zone</th>
          <th>Type</th>
          <th>CPU%</th>
          <th>MEM%</th>
        </tr>
      </thead>
      <tbody>
        {% for inst in result.instances %}
        <tr>
          <td>{{inst.instance}}</td>
          <td>{{inst.zone}}</td>
          <td>{{inst.machineType}}</td>
          <td>{{inst.cpu_utilization_pct}}</td>
          <td>{{inst.memory_used_pct}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</body>
</html>
